services:
  planka:
    image: ghcr.io/plankanban/planka:2.0.0-rc.4
    restart: on-failure
    volumes:
      - favicons:/app/public/favicons
      - user-avatars:/app/public/user-avatars
      - background-images:/app/public/background-images
      - attachments:/app/private/attachments
    ports:
      - 1337  # Expose internal port only - Dokploy handles external routing
    environment:
      # Set these in Dokploy UI environment variables
      - BASE_URL=${BASE_URL}
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${SECRET_KEY}

      # Optional configurations
      - DEFAULT_ADMIN_EMAIL=${DEFAULT_ADMIN_EMAIL}
      - DEFAULT_ADMIN_PASSWORD=${DEFAULT_ADMIN_PASSWORD}
      - DEFAULT_ADMIN_NAME=${DEFAULT_ADMIN_NAME}

      # OIDC (Google OAuth)
      - OIDC_ISSUER=${OIDC_ISSUER}
      - OIDC_CLIENT_ID=${OIDC_CLIENT_ID}
      - OIDC_CLIENT_SECRET=${OIDC_CLIENT_SECRET}
      - OIDC_SCOPES=${OIDC_SCOPES:-openid profile email}
      - OIDC_IGNORE_ROLES=${OIDC_IGNORE_ROLES:-true}

      # SMTP
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT:-465}
      - SMTP_SECURE=${SMTP_SECURE:-true}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_FROM=${SMTP_FROM}

      # Proxy
      - TRUST_PROXY=${TRUST_PROXY:-true}

volumes:
  favicons:
  user-avatars:
  background-images:
  attachments:
